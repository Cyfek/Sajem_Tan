<html>
  <head>
    <title>Sajem Tan Root-finder</title>
    <script type="text/javascript" src="lexicon.js"></script>
    <link rel="shortcut icon" type="image/png" href="flag.png">
  </head>
  <body>
    <a href="index.html">Sajem Tan tools index</a>
    <h3>Sajem Tan unused-root-finder</h3>
    <p>Fish's wheighted generator can be found <a href="https://files.fileswhatever.net/WordGen.php?datafile=sajemtan.yml&root=Root">here</a>.</p>
    <span>Is </span>
    <input type="text" id="doublecheck" onkeyup="doublecheck();"></input>
    <span> already a word? (Reformed Orthography </span>
    <input type="checkbox" id="isnew" onchange="doublecheck();"></input>
    <span>) </span>
    <span id="yesno" style="color: green;">NO</span>
    <p>Number of syllables:</p>
    <span>Minimum: </span>
    <input id="min" type="number" value="1" min="1"></input>
    <br>
    <span>Maximum: </span>
    <input id="max" type="number" value="5" min="1"></input>
    <p>Type:</p>
    <input type="radio" name="type" value="root" checked="checked">Root</input>
    <input type="radio" name="type" value="suf">Suffix/Particle</input>
    <br>
    <span>Number of roots to generate: </span>
    <input id="count" type="number" value="1" min="1"></input>
    <br>
    <br>
    <button onclick="find();">Generate</button>
    <h3>Result:</h3>
    <table id="out"></table>
    <script>
      var c = ["fm", "fn", "vm", "vn", "sn", "zn", "shn", "zhn", "sln", "zln", "thm", "thn", "c", "t", "k", "d", "g", "m", "n", "f", "v", "th", "s", "z", "sh", "zh", "sl", "zl", "x", "j"];
      var rv = ["ol", "e", "el", "i", "a", "ul", "uh", "y"];
      var sv = ["o", "ah", "eh", "u"];
      var coda = ["c", "t", "k", "m", "n"];
      var make = function(mn, mx, typ) {
        var s = "";
        if (typ == "root") {
          for (var i = 0; i < mx; i++) {
            s += c[Math.floor(Math.random() * c.length)];
            s += rv[Math.floor(Math.random() * rv.length)];
            if (i >= mn && Math.random() * (mx - mn) < 1) {
              break;
            }
          }
          s += coda[Math.floor(Math.random() * coda.length)];
        } else {
          if (Math.random() < 0.5) {
            s += c[Math.floor(Math.random() * c.length)];
          }
          s += sv[Math.floor(Math.random() * sv.length)];
          if (Math.random() < 0.5) {
            s += coda[Math.floor(Math.random() * coda.length)];
          }
        }
        console.log(s);
        return s;
      };
      var aux = aux = queryLexPath(["aux"], false, false);
      var l = Object.keys(aux);
      for (var i = 0; i < l.length; i++) {
        generateAux(l[i], true).map(function(k) { aux[k] = ""; });
      }
      var isword = function(w) {
        return lexicon_flat.hasOwnProperty(w) || aux.hasOwnProperty(w);
      };
      var doublecheck = function() {
        var w = document.getElementById('doublecheck').value;
        if (document.getElementById('isnew').checked) {
          w = tooldortho(w);
        }
        var out = document.getElementById('yesno');
        if (isword(w)) {
          out.innerText = 'YES';
          out.style.color = 'red';
        } else {
          out.innerText = 'NO';
          out.style.color = 'green';
        }
      };
      var find = function() {
        var mn = document.getElementById('min').value;
        var mx = document.getElementById('max').value;
        var typ = document.querySelector('input[name="type"]:checked').value;
        var count = document.getElementById('count').value;
        var r = {};
        var s;
        for (var i = 0; i < count; i++) {
          s = make(mn, mx, typ);
          while (isword(s) || r.hasOwnProperty(s)) {
            s = make(mn, mx, typ);
          }
          r[s] = 0;
        }
        var outstr = "<tbody><tr><th>Old Orthography</th><th>Reformed Orthography</th></tr>";
        var wl = Object.keys(r);
        for (var i = 0; i < wl.length; i++) {
          outstr += "<tr><td>" + wl[i] + "</td><td>" + tonewortho(wl[i]) + "</td></tr>";
        }
        document.getElementById("out").innerHTML = outstr + "</tbody>";
        //document.getElementById("out").innerHTML = Object.keys(r).join("<br>");
      };
    </script>
  </body>
</html>
