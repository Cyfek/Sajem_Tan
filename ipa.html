<head>
  <title>Sajem Tan Romanization to IPA</title>
  <meta charset="UTF-8">
  <link rel="shortcut icon" type="image/png" href="flag.png">
</head>
<body>
  <a href="index.html" style="display: block">Sajem Tan tools index</a>
  <textarea id="orth" rows="4" cols="50"></textarea><br>
  <select id="from">
    <option value="oldorth"> Original Orthography</option>
    <option value="neworth"> Reformed Orthography</option>
    <option value="oldipa"> Original IPA</option>
    <option value="newipa"> Reformed IPA</option>
    <option value="hebrew"> Hebrew</option>
  </select>
  &rarr;
  <select id="to">
    <option value="oldorth"> Original Orthography</option>
    <option value="neworth"> Reformed Orthography</option>
    <option value="oldipa"> Original IPA</option>
    <option value="newipa"> Reformed IPA</option>
    <option value="hebrew"> Hebrew</option>
  </select>
  <input id="switch" type="button" value="Switch" onclick="parse()">
  <input id="con" type="checkbox">Don't convert "con ... om"</input>
  <p id="ipa" style="white-space: pre;"></p>
  <script type="text/javascript">
    var charsets = {
      oldipa: ["\u03b8", "\u0283", "\u0292", "\u026c", "\u026e", "\u0251", "\u025b", "\u0153", "\u00f8", "\u028c", "\u0264",
        "d", "g", "x", "\u028e", "f", "v", "s", "z", "m", "n", "e", "y", "i", "t\u0361s", "t", "k", "\u0275", "u", "\u00e6"],
      newipa: ["\u03b8", "\u0283", "\u0292", "\u026c", "\u026e", "\u0251", "\u025b", "\u0153", "\u00f8", "\u028c", "\u028a",
        "d", "g", "x", "j", "f", "v", "s", "z", "m", "n", "e", "y", "i", "t\u0361s", "t", "k", "o", "u", "\u00e6"],
      oldorth: ["th", "sh", "zh", "sl", "zl", "ah", "eh", "el", "ol", "uh", "ul",
        "d", "g", "x", "j", "f", "v", "s", "z", "m", "n", "e", "y", "i", "c", "t", "k", "o", "u", "a",
        "Th", "Sh", "Zh", "Sl", "Zl", "Ah", "Eh", "El", "Ol", "Uh", "Ul",
        "D", "G", "X", "J", "F", "V", "S", "Z", "M", "N", "E", "Y", "I", "C", "T", "K", "O", "U", "A",
        "TH", "SH", "ZH", "SL", "ZL", "AH", "EH", "EL", "OL", "UH", "UL"],
      neworth: ["ţ", "š", "ž", "l", "r", "â", "ê", "ë", "ö", "û", "ü",
        "d", "g", "x", "j", "f", "v", "s", "z", "m", "n", "e", "y", "i", "c", "t", "k", "o", "u", "a",
        "Ţ", "Š", "Ž", "L", "R", "Â", "Ê", "Ë", "Ö", "Û", "Ü",
        "D", "G", "X", "J", "F", "V", "S", "Z", "M", "N", "E", "Y", "I", "C", "T", "K", "O", "U", "A",
        "Ţ", "Š", "Ž", "L", "R", "Â", "Ê", "Ë", "Ö", "Û", "Ü"],
      hebrew: ["ת", "שׁ", "שׂ", "ל", "ר", "\u05b8", "\u05b6", "עֶ", "עֵ", "\u05b0", "\u05b3",
      "ד", "ג", "ח", "י", "פ", "ו", "ס", "ז", "מ", "נ", "\u05b5", "עִ", "\u05b4", "צ", "ט", "כ", "עֹ", "\u05bb", "\u05b7"],
    };
    
    var conregices = {
      oldipa: /((?<=t\u0361son) .* (?=om)|.)/i,
      newipa: /((?<=t\u0361son) .* (?=om)|.)/i,
      oldorth: /((?<=con) .* (?=om)|[szeu][hl]|th|ol|ah|.)/i,
      neworth: /((?<=con) .* (?=om)|.)/i,
      hebrew: /((?<=\u05e6\u05e2\u05b9[\u05df\u05e0]) .* (?=\u05e2\u05b9[\u05dd\u05de])|\u05e2.|.)/i
    };
    
    var preprocess = {
      hebrew: [["ף", "פ"], ["ם", "מ"], ["ן", "נ"], ["ך", "כ"], ["ץ", "צ"]]
    }
    var postprocess = {
      hebrew: [["פ ", "ף "], ["כ ", "ך "], [" נ ", "ן "], ["מ ", "ם "], ["צ ", "ץ "]]
    }
    
    var hascase = {
      oldipa: false, newipa: false,
      oldorth: true, neworth: true,
      hebrew: false
    };
    
    for (var k in hascase) {
      if (!hascase[k]) {
        charsets[k] = charsets[k].concat(...charsets[k], ...charsets[k].slice(0, 11));
      }
    }
    
    var FROM = document.getElementById("from");
    var TO = document.getElementById("to");
    var IN = document.getElementById("orth");
    var OUT = document.getElementById("ipa");
    
    function swap(str, a, b) {
      return str.replace(new RegExp(a, "g"), b);
    }
    
    function parse() {
      var input = IN.value;
      var inlist = charsets[FROM.value];
      var outlist = charsets[TO.value];
      
      if (preprocess.hasOwnProperty(FROM.value)) {
        var prep = preprocess[FROM.value];
        for (var i = 0; i < prep.length; i++) {
          input = swap(input, prep[i][0], prep[i][1]);
        }
      }
      
      if (document.getElementById("con").checked) {
        input = input.split(conregices[FROM.value]);
        var charmap = {};
        for (var i = 0; i < inlist.length; i++) {
          if (!charmap.hasOwnProperty(inlist[i])) {
            charmap[inlist[i]] = outlist[i];
          }
        }
        input = input.map(function(x) { return charmap[x] || x; }).join('');
      } else {
        var upto = (hascase[FROM.value] ? inlist.length : 30);
        for (var i = 0; i < upto; i++) {
          input = swap(input, inlist[i], outlist[i]);
        }
      }
      
      if (postprocess.hasOwnProperty(TO.value)) {
        input = input + ' ';
        var post = postprocess[TO.value];
        for (var i = 0; i < post.length; i++) {
          input = swap(input, post[i][0], post[i][1]);
        }
        input = input.slice(0, -1);
      }
      OUT.innerHTML = input;
    }
  </script>
</body>
